% !TEX root = ../../HSRTReport.cls
% ==============================================================================
% Logos Module
% ==============================================================================
% Description: Logo management and positioning for title and footer pages
% Author: Frederik Beimgraben
% License: Creative Commons CC BY 4.0
% ==============================================================================

% ==============================================================================
% Required Packages
% ==============================================================================
\RequirePackage{tikz}
\RequirePackage{tikzpagenodes}
\RequirePackage{graphicx}
\RequirePackage{arrayjobx}
\RequirePackage{etoolbox}
\RequirePackage{bophook}
\RequirePackage{calc}
\RequirePackage{ifthen}

% ==============================================================================
% Logo Scale Settings
% ==============================================================================
\newcommand{\logosScale}{1}
\newcommand{\mainLogoScale}{1}
\newlength{\imageHeight}

% Set the scale for all logos
\DeclareRobustCommand{\SetLogosScale}[1]{
	\renewcommand{\logosScale}{#1}
}

% ==============================================================================
% Logo Array Management
% ==============================================================================
% Configure array handling for global scope
\let\newglobalarray\newarray
\patchcmd{\newglobalarray}{\edef}{\xdef}{}{}

% Enable array element expansion
\expandarrayelementtrue

% ==============================================================================
% Logo Storage Arrays
% ==============================================================================
% Arrays to store logo properties
\newglobalarray\LogosPaths
\newglobalarray\LogosScales

% Counter for number of logos
\newcounter{logoCounter}
\setcounter{logoCounter}{0}

% ==============================================================================
% Logo Management Commands
% ==============================================================================
% Add a logo to the arrays
% Usage: \AddLogo{<Name>}{<Scale>}
\DeclareRobustCommand{\AddLogo}[2]{
\stepcounter{logoCounter}
\LogosPaths(\thelogoCounter)={#1}
\LogosScales(\thelogoCounter)={#2}

\testarray{LogosPaths}(\thelogoCounter)
\typeout{Logo \thelogoCounter: \logospath\temp@macro.pdf}
}

% ==============================================================================
% Background Graphics Configuration
% ==============================================================================
% Path to skyline graphic
\def\skylinePath{\classPath/Assets/Images/Skyline.pdf}
\def\logospath{\classPath/Assets/Images/Logos/}

% Footer positioning
\newcommand{\footerYShift}{1.5em}
\newcommand{\footerXShift}{0.7em}

\newcommand*{\IsInteger}[3]{%
    \IfStrEq{#1}{ }{%
        #3% is a blank string
    }{%
        \IfInteger{#1}{#2}{#3}%
    }%
}%

% ==============================================================================
% Logo Placement on Pages
% ==============================================================================
% Define logo positioning at beginning of each page
\AtBeginPage{
	\setlength{\imageHeight}{2cm*\real{\mainLogoScale}*\real{\logosScale}*\real{0.45}}
	\begin{tikzpicture}[overlay, remember picture]
		% === Main Logo(s) ===
		\node[anchor=south east, inner sep=0pt, xshift=-\rightmargin, yshift=\footerYShift, opacity=0.0] (logo0) at (current page.south east) {
			\strcompare{\thepage}{0}{}{
				\includegraphics[height=\imageHeight]{\imagesPath/DUMMY_FOOT.png}
			}
		};
		\ifdefstring{\istitlepage}{\true}{}{
  		\ifdefstring{\ShowFooterLogos}{\true}{
  		  \foreach \i in {1,...,\value{logoCounter}} {
  				% Calculate name for i-1
  				\pgfmathtruncatemacro{\prev}{\i-1}
  				\node[anchor=east, inner sep=0pt, xshift=-1.5cm, yshift=2pt] (logo\i) at (logo\prev.west) {
  					\makeatletter
  					\testarray{LogosScales}(\i)
  					\setlength{\imageHeight}{1.5cm*\real{\temp@macro}*\real{\logosScale}*\real{0.55}}
  					\testarray{LogosPaths}(\i)
  					\begin{tikzpicture}
  						\node[] {
  						  \includegraphics[height=\imageHeight]{\logospath\temp@macro.pdf}
  						};
  					\end{tikzpicture}
  					\makeatother
  				};
  			}
  		}{}
		}
		% Skyline
		\node[anchor=south west, inner sep=0pt, yshift=0em] at (current page.south west) {
			\includegraphics[width=1.5\paperwidth]{\skylinePath}
		};
	\end{tikzpicture}
}

% ==============================================================================
% End of Logos Module
% ==============================================================================
