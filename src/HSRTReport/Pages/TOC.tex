% !TEX root = ../Main.tex
% ==============================================================================
% Table of Contents and Lists
% ==============================================================================
% Description: This file generates the table of contents and all document lists
%              including figures, tables, equations, listings, and glossaries.
%              The formatting uses the blenderfont style for consistency.
% Author: Frederik Beimgraben
% Date: 19.11.2025
% ==============================================================================

% ------------------------------------------------------------------------------
% Table of Contents
% ------------------------------------------------------------------------------
% Generate the main table of contents with custom formatting
% The blenderfont provides a consistent typographic style
% ------------------------------------------------------------------------------

\newcommand{\offsetA}{\vspace{-3.5em}}
\newcommand{\maketoc}{
  \newpage
  \pagenumbering{roman}
  {
  	% Remove title
  	\let\oldcontentsname\contentsname
  	\renewcommand{\contentsname}{}

  	% Formatting
  	\blenderfont
  	\chapter*{\oldcontentsname}
  	% Configure TOC page breaking to keep chapters with their sections
  	% Set penalties to keep related entries together
  	\begingroup
  	\interlinepenalty=500      % Discourage breaks within entries
  	\widowpenalty=10000        % Prevent orphaned lines
  	\clubpenalty=10000         % Prevent widowed lines
  	\brokenpenalty=10000       % Penalty for hyphenated breaks

  	\makeatletter
  	% Add hook to keep short chapters together on same page
  	\pretocmd{\l@chapter}{%
  		\needspace{10\baselineskip} % Ensure space for chapter + sections
  		\nopagebreak[4]%            % Strongly discourage break after chapter
  	}{}{}

  	% Keep sections with their chapter
  	\pretocmd{\l@section}{%
  		\nopagebreak[3]%            % Discourage break before first sections
  	}{}{}
  	\makeatother

  	\offsetA
  	\tableofcontents
  	\endgroup
  }

  % Add vertical fill to push subsequent content down
  \vspace{\fill}

  % ------------------------------------------------------------------------------
  % Lists of Figures, Tables, Listings, and Equations
  % ------------------------------------------------------------------------------
  % Generate all lists on a single page with compact spacing
  % The lists will only show entries if they exist
  % ------------------------------------------------------------------------------
  \newpage
  {
  	% Remove titles
  	\let\oldlistfigurename\listfigurename
  	\let\oldlisttablename\listtablename
  	\providecommand{\lstlistlistingname}{Listings}% Provide default if not defined
  	\let\oldlstlistlistingname\lstlistlistingname
  	\providecommand{\listequationsname}{List of Equations}% Provide default if not defined
  	\let\oldlistequationsname\listequationsname
  	\renewcommand{\listfigurename}{}
  	\renewcommand{\listtablename}{}
  	\renewcommand{\lstlistlistingname}{}
  	\renewcommand{\listequationsname}{}

  	% Formatting
  	\noindent
  	\blenderfont

  	% List of Figures
  	\chapter*{\oldlistfigurename}
  	\offsetA\vspace{1em}
  	\listoffigures

  	% List of Tables
  	\vspace{1em}
  	\chapter*{\oldlisttablename}
  	\offsetA\vspace{1em}
  	\listoftables

  	% List of Listings
  	% \vspace{1em}
  	% \chapter*{\oldlstlistlistingname}
  	% \offsetB
  	% \lstlistoflistings

  	% List of Equations
  	\vspace{1em}
  	\chapter*{\oldlistequationsname}
  	\offsetA\vspace{-4em}
  	\listofmyequations
  }

  \AddToHook{cmd/chapter/before}{\clearpage}
}
% Make each following chapter start on a blank page

% ==============================================================================
% End of Table of Contents and Lists
% ==============================================================================
